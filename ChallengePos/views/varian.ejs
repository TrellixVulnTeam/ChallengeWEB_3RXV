<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Soppeng Admin</title>
  <!-- plugins:css -->
  <link rel="stylesheet" href="../../public/assets/vendors/mdi/css/materialdesignicons.min.css">
  <link rel="stylesheet" href="../../public/assets/vendors/css/vendor.bundle.base.css">
  <!-- endinject -->
  <!-- Plugin css for this page -->
  <link rel="stylesheet" href="../../public/assets/vendors/select2/select2.min.css">
  <link rel="stylesheet" href="../../public/assets/vendors/select2-bootstrap-theme/select2-bootstrap.min.css">
  <!-- End plugin css for this page -->
  <!-- inject:css -->
  <!-- endinject -->
  <!-- Layout styles -->
  <link rel="stylesheet" href="../../public/assets/css/style.css">
  <!-- End layout styles -->
  <link rel="shortcut icon" href="../../public/assets/images/favicon.png" />
  <style>
    input {
      cursor: not-allowded;
    }
  </style>
</head>

<body>

  <div class="container-scroller">
    <div class="main-panel">
      <div class="content-wrapper">
        <!-- form tambah -->
        <div class="col-12 grid-margin stretch-card">
          <div class="card">
            <div class="card-body">
              <h4 class="card-title">Tambah Varian</h4>
              <form class="forms-sample" id="form-tambah">
                <div class="form-group">
                  <label for="barcode">ID Varian</label>
                  <input type="text" class="form-control" name="barcode" id="barcode" placeholder="ID varian">
                </div>
                <div class="form-group">
                  <label for="nama_varian">Nama varian</label>
                  <input type="text" class="form-control" name="nama_varian" id="nama_varian" placeholder="Nama varian">
                </div>
                <div class="form-group">
                  <label for="stok">Stock</label>
                  <input type="integer" class="form-control" name="stok" id="stok" placeholder="Stok varian">
                </div>
                <div class="form-group">
                  <label for="buy_price">Harga Beli</label>
                  <input type="integer" class="form-control" name="buy_price" id="buy_price" placeholder="Buy varian">
                </div>
                <div class="form-group">
                  <label for="sell_price">Harga Jual</label>
                  <input type="integer" class="form-control" name="sell_price" id="sell_price"
                    placeholder="Sell varian">
                </div>
                <div class="form-group">
                  <label for="id_barang">ID Barang</label>
                  <select class="form-control" name="id_barang" id="id_barang">
                  </select>
                </div>
                <div class="form-group">
                  <label class="col-sm-12 " for="gambar" style="text-align: center; padding: 15px;"> Upload Image
                  </label>
                  <img id="pict" alt="Your Picture" width="100" height="100" />
                  <input type="file" name="gambar" id="gambar" class="form-control"
                    onchange="document.getElementById('pict').src = window.URL.createObjectURL(this.files[0])"
                    required />
                </div>
                <button type="submit" class="btn btn-primary mr-2">Submit</button>
                <button type="button" id="reset-form-tambah" class="btn btn-dark">Cancel</button>
              </form>
            </div>
          </div>
        </div>
        <!-- form edit -->
        <div class="col-12 grid-margin stretch-card">
          <div class="card">
            <div class="card-body">
              <h4 class="card-title">Edit varian Barang</h4>
              <form class="forms-sample" id="form-edit">
                <div class="form-group">
                  <label for="barcodeedit">ID Varian</label>
                  <input type="text" readonly="readonly" class="form-control" name="barcodeedit" id="barcodeedit">
                </div>
                <div class="form-group">
                  <label for="nama_varianedit">Nama varian</label>
                  <input type="text" class="form-control" name="nama_varianedit" id="nama_varianedit">
                </div>
                <div class="form-group">
                  <label for="stokedit">Stock</label>
                  <input type="integer" class="form-control" name="stokedit" id="stokedit">
                </div>
                <div class="form-group">
                  <label for="buy_priceedit">Harga Beli</label>
                  <input type="integer" class="form-control" name="buy_priceedit" id="buy_priceedit">
                </div>
                <div class="form-group">
                  <label for="sell_priceedit">Harga Jual</label>
                  <input type="integer" class="form-control" name="sell_priceedit" id="sell_priceedit">
                </div>
                <div class="form-group">
                  <label for="id_barangedit">ID Barang</label>
                  <select class="form-control" name="id_barangedit" id="id_barangedit">
                  </select>
                </div>
                <div class="form-group">
                  <label class="col-sm-12 " for="gambaredit" style="text-align: center; padding: 15px;"> Upload Image
                  </label>
                  <img id="pictedit" alt="Your Picture" width="100" height="100" />
                  <input type="file" name="gambaredit" id="gambaredit" class="form-control" 
                  onchange="document.getElementById('pictedit').src = window.URL.createObjectURL(this.files[0])"/>
                </div>
                <button type="submit" class="btn btn-primary mr-2">Submit</button>
                <button type="button" id="reset-form-edit" class="btn btn-dark">Cancel</button>
              </form>
            </div>
          </div>
        </div>

        <!-- table -->
        <div class="card">
          <div class="card-body">
            <h4 class="card-title">Daftar varian</h4>
            <div class="table-responsive">
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th> Barcode </th>
                    <th> ID Barang</th>
                    <th> Nama Barang</th>
                    <th> Nama Varian</th>
                    <th> Stok</th>
                    <th> Picture</th>
                    <th> Harga Jual</th>
                    <th> Harga Beli</th>
                  </tr>
                </thead>
                <tbody>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>



</body>

<script src="../../public/assets/vendors/js/vendor.bundle.base.js"></script>
<!-- endinject -->
<!-- Plugin js for this page -->
<script src="../../public/assets/vendors/select2/select2.min.js"></script>
<script src="../../public/assets/vendors/typeahead.js/typeahead.bundle.min.js"></script>
<!-- End plugin js for this page -->
<!-- inject:js -->
<script src="../../public/assets/js/off-canvas.js"></script>
<script src="../../public/assets/js/hoverable-collapse.js"></script>
<script src="../../public/assets/js/misc.js"></script>
<script src="../../public/assets/js/settings.js"></script>
<script src="../../public/assets/js/todolist.js"></script>
<!-- endinject -->
<!-- Custom js for this page -->
<script src="../../public/assets/js/file-upload.js"></script>
<script src="../../public/assets/js/typeahead.js"></script>
<script src="../../public/assets/js/select2.js"></script>
<!-- End custom js for this page -->

<script>
  const readData = () => {
    $.ajax({
      method: "GET",
      url: "http://localhost:3001/varian",
      dataType: "json",
      headers: {
        json: true
      }
    }).done(function (data) {

      let html = ''
      data.forEach((item, index) => {
        console.log(item.picture)
        html += `
        <tr>
          <td>${item.barcode}</td>
          <td>${item.id_barang}</td>
          <td>${item.nama_barang}</td>
          <td>${item.varian_name}</td>
          <td>${item.stok}</td>
          <td> <img src="../public/images/${item.picture}" id='img_${item.barcode}' alt="image" /> </td>
          <td>${item.buy_price}</td>
          <td>${item.sell_price}</td>
          <td>
            <button type="button" class="btn btn-success btn-icon-text" id_data="${item.barcode}"><i class="mdi mdi-file-check btn-icon-append"></i></button>
            <button type="button" class="btn btn-danger btn-icon-delete" id_data="${item.barcode}"><i class="mdi mdi-trash-can btn-icon-append"></i></button>
          </td>
        </tr>
        `
      });
      $('table tbody').html(html)
    }).fail(function (err) {
      console.log("error", err)
      alert('gagal jquery')
    })
  }

  const readSelect = () => {
    $.ajax({
      method: "GET",
      url: "http://localhost:3001/varian/select",
      dataType: "json",
      headers: {
        json: true
      }
    }).done(function (rows) {

      let html = ''
      rows.forEach((item, index) => {
        html += `
        <option value="${item.id_barang}">
         ${item.id_barang} - ${item.nama_barang}
        </option>
        `
      });
      $('form select').html(html)
    }).fail(function (err) {
      console.log("error", err)
      alert('gagal jquery tambah salah satu ID')
    })
  }

  const editData = (id) => {
    $.ajax({
      method: "GET",
      url: `http://localhost:3001/varian/${id}`,
      dataType: "json",
      headers: {
        json: true
      }
    }).done(function (data) {
      console.log(data[0].sell_price)
      $('#barcodeedit').val(data[0].barcode)
      $('#nama_varianedit').val(data[0].varian_name)
      $('#stokedit').val(data[0].stok)
      $('#buy_priceedit').val(parseInt(data[0].buy_price))
      $('#sell_priceedit').val(parseInt(data[0].sell_price))
      $('#id_barangedit').val(data[0].id_barang)
    }).fail(function (err) {
      alert('gagal pake jquery')
    })
  }

  const deleteData = (id) => {
    $.ajax({
      method: "DELETE",
      url: `http://localhost:3001/varian/${id}`,
      dataType: "json",
      headers: {
        json: true
      }
    }).done(function (response) {

      readData()
    }).fail(function (err) {
      alert('gagal pake jquery delete')
    })
  }

  $(document).ready(function () {
    readData()
    readSelect()

    $('#form-tambah').submit(function (event) {
      event.preventDefault();
      $.ajax({
        url: `http://localhost:3001/varian`,
        type: 'POST',
        headers: {
          json: true
        },
        // Form data
        data: new FormData($('#form-tambah')[0]),
        cache: false,
        contentType: false,
        processData: false,

      }).then((data) => {

        $("#form-tambah").trigger("reset");
        alert('data berhasil tersave');
        readData()
      }).fail((err) => {
        alert('data gagal tersave')

      })
    })

    $('#form-edit').submit(function (event) {
      event.preventDefault();
      $.ajax({
        url: `http://localhost:3001/varian/${barcode}`,
        type: 'PUT',
        headers: {
          json: true
        },
        // Form data
        data: new FormData($('#form-edit')[0]),
        cache: false,
        contentType: false,
        processData: false,

      }).then((data) => {

        $("#form-edit").trigger("reset");
        alert('data edit berhasil tersave');
        readData()
      }).fail((err) => {
        alert('data gagal tersave')

      })
    })

    $('table tbody').on('click', '.btn-icon-text', function () {
      const id = $(this).attr('id_data')
      editData(id)

    })

    $('table tbody').on('click', '.btn-icon-delete', function () {
      const id = $(this).attr('id_data')
      deleteData(id)
    })

    $('#reset-form-tambah').click(function () {
      $("#form-tambah").trigger("reset");
      readData()
    })

    $('#reset-form-edit').click(function () {
      $("#form-edit").trigger("reset");
      readData()
    })



  })
</script>

</html>